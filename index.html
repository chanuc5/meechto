<!DOCTYPE html>
<html lang="mr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meechto Resume Maker - ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§Ü‡§£‡§ø ‡•≤‡§°‡§Æ‡§ø‡§® ‡§™‡•Ö‡§®‡§≤</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Firebase Imports -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithCustomToken, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, addDoc, setDoc, updateDoc, deleteDoc, onSnapshot, collection, query, where, getDocs, orderBy, limit, serverTimestamp, runTransaction } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-storage.js"; // Storage Import
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // --- MANDATORY CANVAS GLOBALS ---
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {
            apiKey: "AIzaSyBr9aWf7RcqDOJU1lakNsP0y1Gi9i9Ry3o",
            authDomain: "meechto-resume.firebaseapp.com",
            projectId: "meechto-resume",
            storageBucket: "meechto-resume.firebasestorage.app",
            messagingSenderId: "50111983443",
            appId: "1:50111983443:web:bae8f8e63701f11a537ba6",
            measurementId: "G-L5356HBP7T"
        };
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        // --- END CANVAS GLOBALS ---

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const storage = getStorage(app); // Initialize Storage
        
        // Firestore path structure
        const TEMPLATES_COLLECTION = `artifacts/${appId}/public/data/templates`;
        
        // --- ADMIN LOGIN CREDENTIALS ---
        const ADMIN_USERNAME = 'remech96@gmail.com';
        const ADMIN_EMAIL = 'remech96@gmail.com'; 
        const ADMIN_PASSWORD = 'Cha@123';
        // -------------------------------

        // Global state
        window.db = db;
        window.auth = auth;
        window.storage = storage; // Make storage globally available for JS functions
        window.TEMPLATES_COLLECTION = TEMPLATES_COLLECTION;
        window.adminIsLoggedIn = false;
        window.templatesData = [];

        // Debug logging (optional, but good for debugging)
        setLogLevel('Debug');
        
        // --- AUTHENTICATION & INITIALIZATION ---
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // Check if user is the admin (based on email configured in Firebase Auth)
                if (user.email === ADMIN_EMAIL) { 
                    window.adminIsLoggedIn = true;
                    setupTemplateListener();
                    if(document.getElementById('admin-login-modal').classList.contains('hidden')) {
                        showAdminPanel(); 
                    }
                } else {
                    window.adminIsLoggedIn = false;
                    signOut(auth); 
                }
            } else {
                window.adminIsLoggedIn = false;
            }
        });

        if (initialAuthToken) {
            signInWithCustomToken(auth, initialAuthToken).catch(console.error);
        }

        // --- CUSTOMER TEMPLATE LOADING ---
        function loadTemplatesForCustomer() {
             const templateRef = collection(db, TEMPLATES_COLLECTION);
             onSnapshot(templateRef, (snapshot) => {
                const fetchedTemplates = snapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                })).sort((a, b) => a.order - b.order);

                window.templatesData = fetchedTemplates;
                renderCustomerTemplates(fetchedTemplates);
                renderAdminTemplateList(fetchedTemplates); 
             }, (error) => {
                console.error("Error fetching customer templates: Please check Firebase Security Rules for 'allow read: true;' on the templates collection.", error);
                renderCustomerTemplates(null); 
             });
        }
        
        loadTemplatesForCustomer();

        function renderCustomerTemplates(templates) {
            const container = document.querySelector('.template-grid');
            if (!container) return;
            
            // --- Fallback Data (No change to logic, just for display) ---
            const fallbackTemplates = [
                { id: 'fb-clean', name: '‡§ï‡•ç‡§≤‡•Ä‡§® ‡§™‡•ç‡§∞‡•ã‡§´‡§æ‡§à‡§≤', description: '‡§∏‡§æ‡§ß‡•á ‡§°‡§ø‡§ù‡§æ‡§à‡§®', order: 1, imageUrl: 'https://placehold.co/150x225/4f46e5/ffffff?text=Fallback+1' },
                { id: 'fb-modern', name: '‡§Æ‡•â‡§°‡§∞‡•ç‡§® ‡§ó‡•ç‡§∞‡§æ‡§´‡•Ä', description: '‡§∞‡§Ç‡§ó‡•Ä‡§§ ‡§•‡•Ä‡§Æ', order: 2, imageUrl: 'https://placehold.co/150x225/10b981/ffffff?text=Fallback+2' },
                { id: 'fb-minimal', name: '‡§Æ‡§ø‡§®‡§ø‡§Æ‡§≤‡§ø‡§∏‡•ç‡§ü', description: '‡§•‡•ã‡§°‡§ï‡•ç‡§Ø‡§æ‡§§', order: 3, imageUrl: 'https://placehold.co/150x225/f59e0b/ffffff?text=Fallback+3' },
            ];
            // -----------------------------------------------------------

            let templatesToRender = templates;
            let isFallback = false;
            let errorMessage = '';

            if (!templates || templates.length === 0) {
                if (templates === null) { 
                    templatesToRender = fallbackTemplates;
                    isFallback = true;
                    errorMessage = `<p class="col-span-full text-center text-red-500 font-semibold p-4 bg-white rounded-lg">Firebase ‡§≤‡§æ ‡•≤‡§ï‡•ç‡§∏‡•á‡§∏ ‡§Æ‡§ø‡§≥‡§æ‡§≤‡§æ ‡§®‡§æ‡§π‡•Ä. ‡•≤‡§°‡§Æ‡§ø‡§®‡§≤‡§æ 'Security Rules' ‡§§‡§™‡§æ‡§∏‡§æ‡§µ‡•Ä ‡§≤‡§æ‡§ó‡§§‡•Ä‡§≤. (‡§§‡§æ‡§§‡•ç‡§™‡•Å‡§∞‡§§‡•á ‡§ü‡•á‡§Æ‡•ç‡§™‡•ç‡§≤‡•á‡§ü ‡§¶‡§ø‡§∏‡§§ ‡§Ü‡§π‡•á‡§§.)</p>`;
                    window.templatesData = fallbackTemplates; 
                } else {
                    errorMessage = `<p class="col-span-full text-center text-gray-500 font-semibold p-8 bg-white rounded-lg">‡•≤‡§°‡§Æ‡§ø‡§®‡§®‡•á ‡§Ö‡§ú‡•Ç‡§® ‡§ï‡•ã‡§£‡§§‡•á‡§π‡•Ä ‡§ü‡•á‡§Æ‡•ç‡§™‡•ç‡§≤‡•á‡§ü ‡§ú‡•ã‡§°‡§≤‡•á‡§≤‡•á ‡§®‡§æ‡§π‡•Ä‡§§.</p>`;
                    document.getElementById('next-to-form').disabled = true;
                }
            }

            container.innerHTML = errorMessage; 

            if (templatesToRender && templatesToRender.length > 0) {
                if (!isFallback) {
                     container.innerHTML = '';
                }
                
                document.getElementById('next-to-form').disabled = false;
                if (isFallback) {
                    container.innerHTML = errorMessage;
                }


                templatesToRender.forEach((t) => {
                    const uniqueId = isFallback ? `fb-${t.order}` : `t${t.order}`; 
                    const templateValueId = isFallback ? t.id : t.id;
                    
                    // Display image if URL is available, otherwise use a placeholder
                    const imageHtml = t.imageUrl
                        ? `<img src="${t.imageUrl}" alt="${t.name}" class="w-full h-full object-cover" onerror="this.onerror=null; this.src='https://placehold.co/150x225/e5e7eb/4b5563?text=Image+Error';">`
                        : `<div class="w-full h-full flex flex-col items-center justify-center text-center font-bold text-gray-600 bg-gray-200">‡§ü‡•á‡§Æ‡•ç‡§™‡•ç‡§≤‡•á‡§ü T${t.order}<br/>(‡§á‡§Æ‡•á‡§ú ‡§®‡§æ‡§π‡•Ä)</div>`;

                    const card = document.createElement('label');
                    card.id = uniqueId;
                    card.className = "template-card border-2 border-gray-200 rounded-lg p-2";
                    card.htmlFor = `${uniqueId}-radio`;
                    card.innerHTML = `
                        <div class="template-placeholder-box rounded-md overflow-hidden">
                            ${imageHtml}
                        </div>
                        <p class="font-semibold text-center text-xs text-gray-700 mt-1">${t.name}</p>
                        <input type="radio" name="template" id="${uniqueId}-radio" value="${templateValueId}" class="hidden" onclick="window.selectTemplate('${templateValueId}', ${t.order})">
                    `;
                    container.appendChild(card);
                });
            }
            
            if (window.selectedTemplateId) {
                const currentCard = document.querySelector(`input[value="${window.selectedTemplateId}"]`);
                if(currentCard) {
                    const cardElement = currentCard.closest('.template-card');
                    if(cardElement) {
                        window.selectTemplate(window.selectedTemplateId, parseInt(cardElement.id.replace(isFallback ? 'fb-' : 't', '')));
                    }
                }
            }
        }

        // --- ADMIN PANEL FUNCTIONS (SIMPLIFIED) ---

        function setupTemplateListener() {
             const templateRef = collection(db, TEMPLATES_COLLECTION);
             onSnapshot(templateRef, (snapshot) => {
                const fetchedTemplates = snapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                })).sort((a, b) => a.order - b.order);

                window.templatesData = fetchedTemplates;
                renderAdminTemplateList(fetchedTemplates);
                if (document.getElementById('admin-panel-container').classList.contains('active')) {
                     renderCustomerTemplates(fetchedTemplates);
                }
             }, (error) => {
                console.error("Admin Error fetching templates:", error);
                const listContainer = document.getElementById('admin-template-list');
                if (listContainer) {
                    listContainer.innerHTML = `<p class="p-4 text-red-500 text-center">‡•≤‡§°‡§Æ‡§ø‡§® ‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§ï‡§∞‡§§‡§æ‡§®‡§æ ‡§§‡•ç‡§∞‡•Å‡§ü‡•Ä. Firebase ‡§®‡§ø‡§Ø‡§Æ ‡§§‡§™‡§æ‡§∏‡§æ.</p>`;
                }
             });
        }

        function renderAdminTemplateList(templates) {
            const listContainer = document.getElementById('admin-template-list');
            if (!listContainer) return;
            
            listContainer.innerHTML = '';
            
            if (!templates || templates.length === 0) {
                listContainer.innerHTML = `<p class="text-center text-gray-500 p-3">‡§∏‡§ß‡•ç‡§Ø‡§æ ‡§ï‡•ã‡§£‡§§‡•á‡§π‡•Ä ‡§ü‡•á‡§Æ‡•ç‡§™‡•ç‡§≤‡•á‡§ü ‡§ú‡•ã‡§°‡§≤‡•á‡§≤‡•á ‡§®‡§æ‡§π‡•Ä‡§§.</p>`;
                return;
            }

            templates.forEach(t => {
                const listItem = document.createElement('div');
                listItem.className = 'flex justify-between items-center p-3 border-b hover:bg-gray-50';
                listItem.innerHTML = `
                    <span class="text-sm font-medium text-gray-800">T${t.order} - ${t.name}</span>
                    <div class="space-x-2">
                        <button onclick="window.editTemplate('${t.id}')" class="text-indigo-600 hover:text-indigo-800 text-sm">Edit</button>
                        <button onclick="window.deleteTemplate('${t.id}', '${t.name}')" class="text-red-600 hover:text-red-800 text-sm">Delete</button>
                    </div>
                `;
                listContainer.appendChild(listItem);
            });
        }

        window.addTemplate = function() {
            document.getElementById('template-form-title').textContent = '‡§®‡§µ‡•Ä‡§® ‡§ü‡•á‡§Æ‡•ç‡§™‡•ç‡§≤‡•á‡§ü ‡§ú‡•ã‡§°‡§æ';
            document.getElementById('template-id').value = '';
            document.getElementById('template-name').value = '';
            document.getElementById('template-description').value = '';
            document.getElementById('template-order').value = window.templatesData.length ? Math.max(...window.templatesData.map(t => t.order)) + 1 : 1;
            document.getElementById('current-image-status').textContent = '‡§∏‡§ß‡•ç‡§Ø‡§æ ‡§ï‡•ã‡§£‡§§‡•Ä‡§π‡•Ä ‡§á‡§Æ‡•á‡§ú ‡§®‡§æ‡§π‡•Ä.';
            document.getElementById('template-image-file').value = '';
            document.getElementById('admin-template-form').classList.remove('hidden');
        }

        window.editTemplate = function(id) {
            const t = window.templatesData.find(template => template.id === id);
            if (!t) return;
            
            document.getElementById('template-form-title').textContent = '‡§ü‡•á‡§Æ‡•ç‡§™‡•ç‡§≤‡•á‡§ü ‡§è‡§°‡§ø‡§ü ‡§ï‡§∞‡§æ';
            document.getElementById('template-id').value = t.id;
            document.getElementById('template-name').value = t.name;
            document.getElementById('template-description').value = t.description;
            document.getElementById('template-order').value = t.order;
            document.getElementById('current-image-status').textContent = t.imageUrl ? '‡§á‡§Æ‡•á‡§ú ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ù‡§æ‡§≤‡•Ä ‡§Ü‡§π‡•á.' : '‡§∏‡§ß‡•ç‡§Ø‡§æ ‡§ï‡•ã‡§£‡§§‡•Ä‡§π‡•Ä ‡§á‡§Æ‡•á‡§ú ‡§®‡§æ‡§π‡•Ä.';
            document.getElementById('template-image-file').value = '';
            document.getElementById('admin-template-form').classList.remove('hidden');
        }

        window.saveTemplate = async function(e) {
            e.preventDefault();
            
            // Show loading state
            const saveBtn = document.getElementById('save-template-btn');
            saveBtn.disabled = true;
            saveBtn.textContent = '‡§∏‡•á‡§µ‡•ç‡§π ‡§ï‡§∞‡§§ ‡§Ü‡§π‡•á...';

            const id = document.getElementById('template-id').value;
            const name = document.getElementById('template-name').value;
            const description = document.getElementById('template-description').value;
            const order = parseInt(document.getElementById('template-order').value);
            const imageFile = document.getElementById('template-image-file').files[0];
            
            let imageUrl = '';
            let templateDocRef;
            
            // 1. Determine the document reference
            if (id) {
                templateDocRef = doc(db, TEMPLATES_COLLECTION, id);
            } else {
                templateDocRef = doc(collection(db, TEMPLATES_COLLECTION));
            }
            
            // 2. Handle Image Upload if a new file is provided
            if (imageFile) {
                try {
                    // Use a unique name based on doc ID to avoid conflicts
                    const storagePath = `templates/${templateDocRef.id}/${imageFile.name}`;
                    const imageRef = storageRef(storage, storagePath);
                    
                    // Upload file
                    const uploadResult = await uploadBytes(imageRef, imageFile);
                    
                    // Get URL
                    imageUrl = await getDownloadURL(uploadResult.ref);
                    console.log("Image uploaded and URL retrieved:", imageUrl);
                    
                } catch (error) {
                    console.error("Error uploading image:", error);
                    alert('‡§á‡§Æ‡•á‡§ú ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡§§‡§æ‡§®‡§æ ‡§Æ‡•ã‡§†‡•Ä ‡§§‡•ç‡§∞‡•Å‡§ü‡•Ä ‡§Ü‡§≤‡•Ä. Firebase Storage ‡§®‡§ø‡§Ø‡§Æ ‡§§‡§™‡§æ‡§∏‡§æ: ' + error.message);
                    saveBtn.disabled = false;
                    saveBtn.textContent = '‡§∏‡•á‡§µ‡•ç‡§π ‡§ï‡§∞‡§æ';
                    return;
                }
            } else if (id) {
                 // Retain existing URL if editing and no new file is uploaded
                const existingTemplate = window.templatesData.find(t => t.id === id);
                imageUrl = existingTemplate ? existingTemplate.imageUrl : '';
            }

            // 3. Save/Update Firestore Document
            const templateData = { 
                name, 
                description, 
                order, 
                imageUrl: imageUrl,
                // Remove color/icon as per user request
            };
            
            try {
                if (id) {
                    await updateDoc(templateDocRef, templateData);
                    console.log("Template updated:", id);
                } else {
                    await setDoc(templateDocRef, templateData);
                    console.log("Template added:", templateDocRef.id);
                }
                document.getElementById('admin-template-form').classList.add('hidden');
            } catch (error) {
                console.error("Error saving template data:", error);
                alert('‡§ü‡•á‡§Æ‡•ç‡§™‡•ç‡§≤‡•á‡§ü ‡§∏‡•á‡§µ‡•ç‡§π ‡§ï‡§∞‡§§‡§æ‡§®‡§æ ‡§§‡•ç‡§∞‡•Å‡§ü‡•Ä ‡§Ü‡§≤‡•Ä: ' + error.message);
            } finally {
                saveBtn.disabled = false;
                saveBtn.textContent = '‡§∏‡•á‡§µ‡•ç‡§π ‡§ï‡§∞‡§æ';
            }
        }

        window.deleteTemplate = async function(id, name) {
            if (!confirm(`‡§§‡•Å‡§Æ‡•ç‡§π‡•Ä ' ${name} ' ‡§π‡§æ ‡§ü‡•á‡§Æ‡•ç‡§™‡•ç‡§≤‡•á‡§ü ‡§ï‡§æ‡§Ø‡§Æ‡§ö‡§æ ‡§°‡§ø‡§≤‡•Ä‡§ü ‡§ï‡§∞‡•Ç ‡§á‡§ö‡•ç‡§õ‡§ø‡§§‡§æ?`)) return;

            try {
                await deleteDoc(doc(db, TEMPLATES_COLLECTION, id));
                console.log("Template deleted:", id);
            } catch (error) {
                console.error("Error deleting template:", error);
                alert('‡§ü‡•á‡§Æ‡•ç‡§™‡•ç‡§≤‡•á‡§ü ‡§°‡§ø‡§≤‡•Ä‡§ü ‡§ï‡§∞‡§§‡§æ‡§®‡§æ ‡§§‡•ç‡§∞‡•Å‡§ü‡•Ä ‡§Ü‡§≤‡•Ä: ' + error.message);
            }
        }

        // --- ADMIN LOGIN (USERNAME & PASSWORD) ---
        window.handleAdminLogin = async function(e) {
            e.preventDefault();
            const username = document.getElementById('admin-username').value;
            const password = document.getElementById('admin-password').value;
            const errorDiv = document.getElementById('login-error');
            errorDiv.textContent = '';
            
            if (username !== ADMIN_USERNAME) {
                errorDiv.textContent = '‡§Ø‡•Å‡§ú‡§∞‡§®‡•á‡§Æ ‡§ö‡•Å‡§ï‡•Ä‡§ö‡§æ ‡§Ü‡§π‡•á.';
                return;
            }
            if (password !== ADMIN_PASSWORD) {
                errorDiv.textContent = '‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§ö‡•Å‡§ï‡•Ä‡§ö‡§æ ‡§Ü‡§π‡•á.';
                return;
            }

            try {
                const userCredential = await signInWithEmailAndPassword(auth, ADMIN_EMAIL, password);
                
                if (userCredential.user.email === ADMIN_EMAIL) {
                    window.adminIsLoggedIn = true;
                    // Show success message before opening panel
                    document.getElementById('login-form-content').classList.add('hidden');
                    document.getElementById('login-message').classList.remove('hidden');
                    setTimeout(() => {
                        showAdminPanel();
                    }, 1000); // 1 second delay for user to see success message
                } else {
                    errorDiv.textContent = '‡•≤‡§°‡§Æ‡§ø‡§®‡§ö‡•Ä ‡§™‡§°‡§§‡§æ‡§≥‡§£‡•Ä ‡§Ö‡§Ø‡§∂‡§∏‡•ç‡§µ‡•Ä.';
                    await signOut(auth);
                }
            } catch (error) {
                console.error("Login Error:", error);
                errorDiv.textContent = '‡§≤‡•â‡§ó‡§ø‡§® ‡§Ö‡§Ø‡§∂‡§∏‡•ç‡§µ‡•Ä. Firebase Auth ‡§Æ‡§ß‡•ç‡§Ø‡•á ‡§Ø‡•Å‡§ú‡§∞ ‡§§‡§Ø‡§æ‡§∞ ‡§ï‡§∞‡§æ.';
            }
        }

        window.handleAdminLogout = async function() {
            await signOut(auth);
            window.adminIsLoggedIn = false;
            showCustomerView();
        }

        // --- UI STATE MANAGEMENT ---
        window.showCustomerView = function() {
            document.getElementById('customer-view').classList.remove('hidden');
            document.getElementById('admin-panel-container').classList.add('hidden');
            document.getElementById('admin-login-modal').classList.add('hidden');
        }

        window.showAdminLogin = function() {
            document.getElementById('customer-view').classList.add('hidden');
            document.getElementById('admin-panel-container').classList.add('hidden');
            document.getElementById('admin-login-modal').classList.remove('hidden');
            document.getElementById('login-error').textContent = '';
            document.getElementById('login-form-content').classList.remove('hidden');
            document.getElementById('login-message').classList.add('hidden');
        }

        window.showAdminPanel = function() {
            if (!window.adminIsLoggedIn) {
                return showAdminLogin();
            }
            document.getElementById('customer-view').classList.add('hidden');
            document.getElementById('admin-login-modal').classList.add('hidden');
            document.getElementById('admin-panel-container').classList.remove('hidden');
            document.getElementById('admin-panel-container').classList.add('active');
        }
    </script>

    <!-- Tailwind styles are loaded -->
    <style>
        .template-card {
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            aspect-ratio: 2 / 3; 
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
        }
        .template-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 20px rgba(79, 70, 229, 0.4);
        }
        .template-card.selected {
            border-color: #4f46e5;
            box-shadow: 0 0 0 4px #c7d2fe;
        }
        .template-placeholder-box {
            width: 100%;
            height: 90%;
            background-color: #e5e7eb;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 0.65rem;
            font-weight: bold;
            color: #4b5563;
            border-radius: 0.5rem;
            margin-bottom: 0.25rem;
            border: 1px solid #d1d5db;
            text-align: center;
            padding: 0.5rem;
            line-height: 1.2;
            text-transform: uppercase;
            overflow: hidden; 
        }
        
        .admin-header-bar {
            background-color: #4f46e5; /* Indigo */
            color: white;
            padding: 0.75rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }

        .admin-login-btn {
            opacity: 0.4; /* Slightly visible */
            transition: opacity 0.3s, transform 0.3s;
            padding: 0.5rem;
            font-size: 0.8rem;
        }
        .admin-login-btn:hover {
            opacity: 1;
            transform: scale(1.1);
        }

        @media (min-width: 1024px) {
            .template-grid {
                grid-template-columns: repeat(4, minmax(0, 1fr));
            }
        }
        @media (max-width: 640px) {
            .template-grid {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }
        }
    </style>
</head>
<body>
    <!-- Global Header Bar -->
    <header class="admin-header-bar">
        <h1 class="text-xl font-bold">Meechto Resume Maker</h1>
        <!-- Admin Button moved to top right -->
        <button onclick="window.showAdminLogin()" class="admin-login-btn bg-indigo-700 hover:bg-indigo-600 text-white rounded-full text-sm" title="Admin Login">
            ‚öôÔ∏è ‡•≤‡§°‡§Æ‡§ø‡§®
        </button>
    </header>

    <!-- 1. CUSTOMER VIEW (Main App) -->
    <div id="customer-view" class="container-box">
        <h1 class="text-3xl font-extrabold text-center text-gray-800 mb-6">‡§§‡•Å‡§Æ‡§ö‡•Ä ‡§∞‡•á‡§ù‡•ç‡§Ø‡•Å‡§Æ‡•á ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ</h1>
        <p class="text-center text-gray-600 mb-8">‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§ï‡§∞‡§ø‡§Ö‡§∞‡§≤‡§æ ‡§®‡§µ‡§æ ‡§µ‡•á‡§ó ‡§¶‡•á‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä ‡§ñ‡§æ‡§≤‡•Ä‡§≤ ‡§∏‡•ã‡§™‡•ç‡§Ø‡§æ ‡§™‡§æ‡§Ø‡§±‡•ç‡§Ø‡§æ ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§ï‡§∞‡§æ.</p>

        <!-- Step 1: Template Selection -->
        <div id="step-1" class="step">
            <h2 class="text-2xl font-bold mb-4 text-indigo-700">1. ‡§§‡•Å‡§Æ‡§ö‡§æ ‡§Ü‡§µ‡§°‡§§‡§æ ‡§ü‡•á‡§Æ‡•ç‡§™‡•ç‡§≤‡•á‡§ü ‡§®‡§ø‡§µ‡§°‡§æ</h2>
            <!-- Templates will be rendered here by JS from Firestore -->
            <div class="grid gap-4 template-grid">
                 <p class="col-span-full text-center p-4">‡§ü‡•á‡§Æ‡•ç‡§™‡•ç‡§≤‡•á‡§ü ‡§≤‡•ã‡§° ‡§π‡•ã‡§§ ‡§Ü‡§π‡•á‡§§...</p>
            </div>
            
            <button id="next-to-form" class="mt-8 w-full py-3 bg-indigo-500 text-white font-semibold rounded-lg hover:bg-indigo-600 transition duration-300 opacity-50 cursor-not-allowed" disabled>
                ‡§™‡•Å‡§¢‡•á ‡§ú‡§æ (‡§´‡•â‡§∞‡•ç‡§Æ ‡§≠‡§∞‡§æ)
            </button>
        </div>

        <!-- Step 2: Resume Data Form (Same as before) -->
        <div id="step-2" class="step hidden">
            <h2 class="text-2xl font-bold mb-4 text-indigo-700">2. ‡§§‡•Å‡§Æ‡§ö‡§æ ‡§∞‡•á‡§ù‡•ç‡§Ø‡•Å‡§Æ‡•á ‡§´‡•â‡§∞‡•ç‡§Æ ‡§≠‡§∞‡§æ</h2>
            <form id="resume-form" class="space-y-6">
                <!-- Personal Info fields -->
                <div class="border p-4 rounded-lg bg-indigo-50">
                    <h3 class="font-bold text-lg mb-3 text-indigo-800">‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§ó‡§§ ‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div><label for="fullName" class="block text-sm font-medium text-gray-700">‡§™‡•Ç‡§∞‡•ç‡§£ ‡§®‡§æ‡§µ</label><input type="text" id="fullName" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" required></div>
                        <div><label for="jobTitle" class="block text-sm font-medium text-gray-700">‡§®‡•ã‡§ï‡§∞‡•Ä‡§ö‡•á ‡§â‡§¶‡•ç‡§¶‡§ø‡§∑‡•ç‡§ü (Job Title)</label><input type="text" id="jobTitle" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" required></div>
                    </div>
                    <div class="mt-4"><label for="contactNo" class="block text-sm font-medium text-gray-700">WhatsApp ‡§®‡§Ç‡§¨‡§∞ (‡§§‡•Å‡§Æ‡§ö‡§æ)</label><input type="tel" id="contactNo" placeholder="‡§â‡§¶‡§æ. 9421960833" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" required></div>
                    <div class="mt-4"><label for="aboutMe" class="block text-sm font-medium text-gray-700">‡§Æ‡§æ‡§ù‡•ç‡§Ø‡§æ‡§¨‡§¶‡•ç‡§¶‡§≤ (About Me - ‡§•‡•ã‡§°‡§ï‡•ç‡§Ø‡§æ‡§§)</label><textarea id="aboutMe" rows="3" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" required></textarea></div>
                </div>

                <!-- Education fields -->
                <div class="border p-4 rounded-lg bg-white">
                    <h3 class="font-bold text-lg mb-3 text-indigo-800">‡§∂‡•à‡§ï‡•ç‡§∑‡§£‡§ø‡§ï ‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä (‡§∏‡§∞‡•ç‡§µ‡§æ‡§§ ‡§∂‡•á‡§µ‡§ü‡§ö‡•á ‡§∂‡§ø‡§ï‡•ç‡§∑‡§£)</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div><label for="eduDegree" class="block text-sm font-medium text-gray-700">‡§™‡§¶‡§µ‡•Ä/‡§∂‡§ø‡§ï‡•ç‡§∑‡§£</label><input type="text" id="eduDegree" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" required></div>
                        <div><label for="eduYear" class="block text-sm font-medium text-gray-700">‡§µ‡§∞‡•ç‡§∑ (Year)</label><input type="text" id="eduYear" placeholder="‡§â‡§¶‡§æ. 2018-2022" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" required></div>
                    </div>
                    <div class="mt-4"><label for="eduUniversity" class="block text-sm font-medium text-gray-700">‡§∏‡§Ç‡§∏‡•ç‡§•‡•á‡§ö‡•á/‡§ï‡•â‡§≤‡•á‡§ú‡§ö‡•á ‡§®‡§æ‡§µ</label><input type="text" id="eduUniversity" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" required></div>
                </div>

                <!-- Experience fields -->
                <div class="border p-4 rounded-lg bg-white">
                    <h3 class="font-bold text-lg mb-3 text-indigo-800">‡§ï‡§æ‡§Æ‡§æ‡§ö‡§æ ‡§Ö‡§®‡•Å‡§≠‡§µ (‡§∏‡§∞‡•ç‡§µ‡§æ‡§§ ‡§®‡§µ‡•Ä‡§®)</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div><label for="expCompany" class="block text-sm font-medium text-gray-700">‡§ï‡§Ç‡§™‡§®‡•Ä‡§ö‡•á ‡§®‡§æ‡§µ</label><input type="text" id="expCompany" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2"></div>
                        <div><label for="expRole" class="block text-sm font-medium text-gray-700">‡§§‡•Å‡§Æ‡§ö‡•Ä ‡§™‡§¶‡§µ‡•Ä (Role)</label><input type="text" id="expRole" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2"></div>
                    </div>
                    <div class="mt-4"><label for="expDescription" class="block text-sm font-medium text-gray-700">‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§ï‡§æ‡§Æ‡§æ‡§ö‡•á ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§Æ‡•Å‡§¶‡•ç‡§¶‡•á (Bullet Points - 3-4 ‡§µ‡§æ‡§ï‡•ç‡§Ø‡§æ‡§Ç‡§§ ‡§≤‡§ø‡§π‡§æ)</label><textarea id="expDescription" rows="3" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2"></textarea></div>
                </div>

                <!-- Skills fields -->
                <div class="border p-4 rounded-lg bg-white">
                    <h3 class="font-bold text-lg mb-3 text-indigo-800">‡§§‡•Å‡§Æ‡§ö‡•á ‡§ï‡•å‡§∂‡§≤‡•ç‡§Ø‡•á (Skills - ‡§ï‡•â‡§Æ‡§æ‡§®‡•á ‡§µ‡•á‡§ó‡§≥‡•á ‡§ï‡§∞‡§æ)</h3>
                    <input type="text" id="skills" placeholder="‡§â‡§¶‡§æ: Marketing, Budget Management, Teamwork" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" required>
                </div>

                <button type="submit" class="w-full py-3 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition duration-300">
                    ‚úÖ ‡§´‡•â‡§∞‡•ç‡§Æ ‡§∏‡§¨‡§Æ‡§ø‡§ü ‡§ï‡§∞‡§æ ‡§Ü‡§£‡§ø ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§ï‡•ã‡§° ‡§Æ‡§ø‡§≥‡§µ‡§æ
                </button>
            </form>
        </div>

        <!-- Step 3: Code Generator -->
        <div id="step-3" class="step hidden text-center">
            <h2 class="text-2xl font-bold mb-6 text-green-700">3. ‡§§‡•Å‡§Æ‡§ö‡•Ä ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§§‡§Ø‡§æ‡§∞ ‡§Ü‡§π‡•á!</h2>
            <div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 mb-6" role="alert">
                <p class="font-bold">‡§Æ‡§π‡§§‡•ç‡§µ‡§æ‡§ö‡•á:</p>
                <p>‡§π‡§æ ‡§Ø‡•Å‡§®‡§ø‡§ï ‡§ï‡•ã‡§° ‡§Ü‡§£‡§ø ‡§´‡•â‡§∞‡•ç‡§Æ‡§Æ‡§ß‡•Ä‡§≤ ‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä ‡§ï‡•â‡§™‡•Ä ‡§ï‡§∞‡•Ç‡§® ‡§Ü‡§Æ‡•ç‡§π‡§æ‡§≤‡§æ **WhatsApp ‡§µ‡§∞ ‡§™‡§æ‡§†‡§µ‡§æ**. ‡§§‡•ç‡§Ø‡§æ‡§®‡§Ç‡§§‡§∞ ‡§´‡§ï‡•ç‡§§ **‡•ß‡•´ ‡§Æ‡§ø‡§®‡§ø‡§ü‡§æ‡§Ç‡§§** ‡§§‡•Å‡§Æ‡§ö‡§æ ‡§∞‡•á‡§ù‡•ç‡§Ø‡•Å‡§Æ‡•á ‡§§‡§Ø‡§æ‡§∞ ‡§π‡•ã‡§à‡§≤!</p>
            </div>
            <p class="text-xl font-semibold text-gray-700 mb-2">‡§§‡•Å‡§Æ‡§ö‡§æ ‡§Ø‡•Å‡§®‡§ø‡§ï ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§ï‡•ã‡§° ‡§Ü‡§π‡•á:</p>
            <div id="generated-code-box" class="bg-gray-100 p-4 border-2 border-dashed border-indigo-300 inline-block rounded-lg mb-6">
                <span id="generated-code" class="text-4xl font-extrabold text-indigo-600 tracking-wider">CODE1234</span>
            </div>
            <p class="text-lg font-semibold text-gray-700 mb-4">‡§®‡§ø‡§µ‡§°‡§≤‡•á‡§≤‡§æ ‡§ü‡•á‡§Æ‡•ç‡§™‡•ç‡§≤‡•á‡§ü: <span id="selected-template-display" class="text-indigo-600"></span></p>

            <div class="space-y-4">
                <button id="copy-code-btn" class="w-full sm:w-auto px-6 py-3 bg-indigo-500 text-white font-semibold rounded-lg hover:bg-indigo-600 transition duration-300">
                    üìã ‡§∏‡§Ç‡§™‡•Ç‡§∞‡•ç‡§£ ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§ï‡•ã‡§° ‡§ï‡•â‡§™‡•Ä ‡§ï‡§∞‡§æ
                </button>
                <a id="whatsapp-link" href="#" target="_blank" class="w-full sm:w-auto px-6 py-3 bg-green-500 text-white font-semibold rounded-lg hover:bg-green-600 transition duration-300 inline-block">
                    üí¨ WhatsApp ‡§µ‡§∞ ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§™‡§æ‡§†‡§µ‡§æ
                </a>
            </div>
        </div>

    </div>

    <!-- 2. ADMIN LOGIN MODAL -->
    <div id="admin-login-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 hidden z-50 flex items-center justify-center">
        <div class="bg-white p-8 rounded-xl shadow-2xl w-full max-w-sm">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">‡•≤‡§°‡§Æ‡§ø‡§® ‡§≤‡•â‡§ó‡§ø‡§®</h2>
            
            <div id="login-form-content">
                <form onsubmit="window.handleAdminLogin(event)">
                    <div class="mb-4">
                        <label for="admin-username" class="block text-sm font-medium text-gray-700">‡§Ø‡•Å‡§ú‡§∞‡§®‡•á‡§Æ</label>
                        <input type="text" id="admin-username" value="Meechtoopenkr" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" required>
                    </div>
                    <div class="mb-6">
                        <label for="admin-password" class="block text-sm font-medium text-gray-700">‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°</label>
                        <input type="password" id="admin-password" value="Cha@123" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" required>
                    </div>
                    <p id="login-error" class="text-red-500 text-sm mb-4"></p>
                    <button type="submit" class="w-full py-2 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition duration-300">‡§≤‡•â‡§ó‡§ø‡§®</button>
                </form>
            </div>

            <div id="login-message" class="hidden text-center p-4 border border-green-300 bg-green-50 rounded-lg">
                <p class="font-bold text-green-700 mb-2">‚úÖ ‡•≤‡§°‡§Æ‡§ø‡§® ‡§Æ‡•ç‡§π‡§£‡•Ç‡§® ‡§≤‡•â‡§ó‡§ø‡§® ‡§Ø‡§∂‡§∏‡•ç‡§µ‡•Ä!</p>
                <p class="text-sm text-green-800">‡§§‡•Å‡§Æ‡§ö‡•á ‡•≤‡§°‡§Æ‡§ø‡§® ‡§™‡•Ö‡§®‡§≤ ‡§â‡§ò‡§°‡§§ ‡§Ü‡§π‡•á...</p>
            </div>
            
            <button onclick="window.showCustomerView()" class="mt-4 w-full text-sm text-gray-500 hover:text-gray-700">‡§∞‡§¶‡•ç‡§¶ ‡§ï‡§∞‡§æ ‡§Ü‡§£‡§ø ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§µ‡•ç‡§π‡•ç‡§Ø‡•Ç‡§µ‡§∞ ‡§™‡§∞‡§§ ‡§ú‡§æ</button>
        </div>
    </div>

    <!-- 3. ADMIN PANEL CONTAINER -->
    <div id="admin-panel-container" class="container-box hidden">
        <div class="flex justify-between items-center mb-6 border-b pb-4">
            <h2 class="text-3xl font-extrabold text-gray-800">‡•≤‡§°‡§Æ‡§ø‡§® ‡§°‡•Ö‡§∂‡§¨‡•ã‡§∞‡•ç‡§°</h2>
            <button onclick="window.handleAdminLogout()" class="px-4 py-2 bg-red-500 text-white font-semibold rounded-lg hover:bg-red-600 transition duration-300 text-sm">‡§≤‡•â‡§ó‡§Ü‡§â‡§ü</button>
        </div>

        <!-- Template Management Section -->
        <h3 class="text-xl font-bold text-indigo-700 mb-3">‡§ü‡•á‡§Æ‡•ç‡§™‡•ç‡§≤‡•á‡§ü ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§æ‡§™‡§®</h3>
        <p class="text-sm text-red-500 mb-3">‡§ü‡•Ä‡§™: ‡•≤‡§°‡§Æ‡§ø‡§® ‡§™‡•Ö‡§®‡§≤‡§ö‡•á ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∑‡§Æ ‡§π‡•ã‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä ‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ Firebase Rules ‡§Æ‡§ß‡•ç‡§Ø‡•á 'write' ‡§Ü‡§£‡§ø Storage Rules ‡§Æ‡§ß‡•ç‡§Ø‡•á 'upload' ‡§ö‡•Ä ‡§™‡§∞‡§µ‡§æ‡§®‡§ó‡•Ä ‡§Ö‡§∏‡§£‡•á ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§Ü‡§π‡•á.</p>

        <button onclick="window.addTemplate()" class="mb-4 px-4 py-2 bg-green-500 text-white font-semibold rounded-lg hover:bg-green-600 transition duration-300 text-sm">
            + ‡§®‡§µ‡•Ä‡§® ‡§ü‡•á‡§Æ‡•ç‡§™‡•ç‡§≤‡•á‡§ü ‡§ú‡•ã‡§°‡§æ
        </button>

        <div class="bg-white rounded-lg shadow border p-4 mb-8">
            <div id="admin-template-list" class="divide-y divide-gray-200">
                <p class="text-center text-gray-500">‡§ü‡•á‡§Æ‡•ç‡§™‡•ç‡§≤‡•á‡§ü ‡§≤‡§ø‡§∏‡•ç‡§ü ‡§≤‡•ã‡§° ‡§π‡•ã‡§§ ‡§Ü‡§π‡•á...</p>
            </div>
        </div>

        <!-- Template Add/Edit Form -->
        <div id="admin-template-form" class="hidden bg-white p-6 rounded-xl shadow-lg border border-indigo-200">
            <h4 id="template-form-title" class="text-xl font-bold mb-4 text-indigo-700">‡§®‡§µ‡•Ä‡§® ‡§ü‡•á‡§Æ‡•ç‡§™‡•ç‡§≤‡•á‡§ü ‡§ú‡•ã‡§°‡§æ</h4>
            <form onsubmit="window.saveTemplate(event)" class="space-y-4">
                <input type="hidden" id="template-id">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div><label for="template-name" class="block text-sm font-medium text-gray-700">‡§®‡§æ‡§µ (Name)</label><input type="text" id="template-name" class="w-full border rounded-md p-2" required></div>
                    <div><label for="template-order" class="block text-sm font-medium text-gray-700">‡§ë‡§∞‡•ç‡§°‡§∞ (Order)</label><input type="number" id="template-order" class="w-full border rounded-md p-2" required></div>
                </div>
                <div><label for="template-description" class="block text-sm font-medium text-gray-700">‡§µ‡§∞‡•ç‡§£‡§® (Description)</label><input type="text" id="template-description" class="w-full border rounded-md p-2" required></div>
                
                <!-- New Image Upload Field -->
                <div class="border p-3 rounded-lg bg-gray-50">
                    <h5 class="text-sm font-medium text-gray-800 mb-2">‡§ü‡•á‡§Æ‡•ç‡§™‡•ç‡§≤‡•á‡§ü ‡§á‡§Æ‡•á‡§ú ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡§æ (.jpg/.png)</h5>
                    <input type="file" id="template-image-file" accept="image/jpeg, image/png" class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100"/>
                    <p id="current-image-status" class="mt-2 text-xs text-gray-500"></p>
                </div>
                
                <div class="flex justify-end space-x-3">
                    <button type="button" onclick="document.getElementById('admin-template-form').classList.add('hidden')" class="px-4 py-2 bg-gray-300 rounded-lg text-gray-800">‡§∞‡§¶‡•ç‡§¶ ‡§ï‡§∞‡§æ</button>
                    <button type="submit" id="save-template-btn" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">‡§∏‡•á‡§µ‡•ç‡§π ‡§ï‡§∞‡§æ</button>
                </div>
            </form>
        </div>

        <!-- Future: Orders/Data View -->
        <h3 class="text-xl font-bold text-indigo-700 mt-8 mb-3">‡§ë‡§∞‡•ç‡§°‡§∞ ‡§Ü‡§£‡§ø ‡§°‡•á‡§ü‡§æ (Future Scope)</h3>
        <div class="bg-yellow-100 p-4 rounded-lg text-yellow-800 text-sm">
            ‡§∏‡§ß‡•ç‡§Ø‡§æ ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï WhatsApp ‡§¶‡•ç‡§µ‡§æ‡§∞‡•á ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§¶‡•á‡§§ ‡§Ü‡§π‡•á‡§§. ‡§≠‡§µ‡§ø‡§∑‡•ç‡§Ø‡§æ‡§§, ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§•‡•á‡§ü ‡§Ø‡•á‡§•‡•á ‡§∏‡•á‡§µ‡•ç‡§π ‡§ù‡§æ‡§≤‡•ç‡§Ø‡§æ‡§∏ ‡§π‡•Ä ‡§Ø‡§æ‡§¶‡•Ä ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§®‡•ç‡§µ‡§ø‡§§ ‡§π‡•ã‡§à‡§≤.
        </div>
    </div>

    <script>
        // --- CUSTOMER APP LOGIC (Copied from previous version, adapted for dynamic data) ---
        const steps = ['step-1', 'step-2', 'step-3'];
        let currentStep = 1;
        window.selectedTemplateId = null; 
        let selectedTemplateOrder = null;
        const businessWhatsappNumber = '919421960833'; 

        // selectTemplate function now takes Firestore ID and order number
        window.selectTemplate = function(templateId, order) {
            window.selectedTemplateId = templateId;
            selectedTemplateOrder = order;
            
            document.querySelectorAll('.template-card').forEach(card => card.classList.remove('selected'));
            
            // Find the card by its order number, checking both 't' (real) and 'fb-' (fallback) prefixes
            let cardElement = document.getElementById(`t${order}`);
            if (!cardElement) {
                 cardElement = document.getElementById(`fb-${order}`);
            }
            if(cardElement) {
                cardElement.classList.add('selected');
            }


            const nextButton = document.getElementById('next-to-form');
            nextButton.disabled = false;
            nextButton.classList.remove('opacity-50', 'cursor-not-allowed');
            nextButton.classList.add('bg-indigo-500', 'hover:bg-indigo-600');
        }

        document.getElementById('next-to-form').addEventListener('click', () => {
            if (window.selectedTemplateId) {
                showStep(2);
            } else {
                console.error('‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ü‡§ß‡•Ä ‡§§‡•Å‡§Æ‡§ö‡§æ ‡§ü‡•á‡§Æ‡•ç‡§™‡•ç‡§≤‡•á‡§ü ‡§®‡§ø‡§µ‡§°‡§æ.');
            }
        });

        function showStep(step) {
            steps.forEach((id, index) => {
                document.getElementById(id).classList.add('hidden');
                if (index + 1 === step) {
                    document.getElementById(id).classList.remove('hidden');
                }
            });
            currentStep = step;
        }

        document.getElementById('resume-form').addEventListener('submit', function(e) {
            e.preventDefault();

            const code = 'RES' + Math.random().toString(36).substr(2, 6).toUpperCase();
            
            const selectedTemplate = window.templatesData.find(t => t.id === window.selectedTemplateId);
            const templateName = selectedTemplate ? selectedTemplate.name : 'Unspecified';

            const data = {
                code: code,
                templateId: window.selectedTemplateId,
                templateName: templateName,
                fullName: document.getElementById('fullName').value.trim(),
                jobTitle: document.getElementById('jobTitle').value.trim(),
                contactNo: document.getElementById('contactNo').value.trim(),
                aboutMe: document.getElementById('aboutMe').value.trim(),
                eduDegree: document.getElementById('eduDegree').value.trim(),
                eduYear: document.getElementById('eduYear').value.trim(),
                eduUniversity: document.getElementById('eduUniversity').value.trim(),
                expCompany: document.getElementById('expCompany').value.trim(),
                expRole: document.getElementById('expRole').value.trim(),
                expDescription: document.getElementById('expDescription').value.trim(),
                skills: document.getElementById('skills').value.trim(),
                timestamp: new Date().toLocaleString('mr-IN')
            };

            // 3. Create the complete WhatsApp message with all data
            let whatsappMessage = `*üåü ‡§®‡§µ‡•Ä‡§® Resume ‡§ë‡§∞‡•ç‡§°‡§∞ üåü*\n` +
                `-----------------------------------------\n` +
                `*‡§ë‡§∞‡•ç‡§°‡§∞ ‡§ï‡•ã‡§° (Order Code):* ${data.code}\n` +
                `*‡§ü‡•á‡§Æ‡•ç‡§™‡•ç‡§≤‡•á‡§ü (Template):* #${selectedTemplateOrder} - ${data.templateName} (ID: ${data.templateId})\n` +
                `-----------------------------------------\n` +
                `*‡•ß. ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§ó‡§§ ‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä (Personal Info):*\n` +
                `  ‡§®‡§æ‡§µ: ${data.fullName}\n` +
                `  ‡§â‡§¶‡•ç‡§¶‡§ø‡§∑‡•ç‡§ü: ${data.jobTitle}\n` +
                `  ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï: ${data.contactNo}\n` +
                `  ‡§Æ‡§æ‡§ù‡•ç‡§Ø‡§æ‡§¨‡§¶‡•ç‡§¶‡§≤ (About Me):\n` +
                `  ${data.aboutMe}\n` +
                `*‡•®. ‡§∂‡§ø‡§ï‡•ç‡§∑‡§£ (Education):*\n` +
                `  ‡§™‡§¶‡§µ‡•Ä: ${data.eduDegree}\n` +
                `  ‡§∏‡§Ç‡§∏‡•ç‡§•‡§æ: ${data.eduUniversity} (${data.eduYear})\n` +
                `*‡•©. ‡§Ö‡§®‡•Å‡§≠‡§µ (Experience):*\n` +
                `  ‡§ï‡§Ç‡§™‡§®‡•Ä: ${data.expCompany || '‡§®‡§æ‡§π‡•Ä/None'}\n` +
                `  ‡§™‡§¶‡§µ‡•Ä: ${data.expRole || '‡§®‡§æ‡§π‡•Ä/None'}\n` +
                `  ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§Æ‡•Å‡§¶‡•ç‡§¶‡•á: ${data.expDescription || '‡§®‡§æ‡§π‡•Ä/None'}\n` +
                `*‡•™. ‡§ï‡•å‡§∂‡§≤‡•ç‡§Ø‡•á (Skills):*\n` +
                `  ${data.skills}\n` +
                `-----------------------------------------\n` +
                `_‡§ï‡•É‡§™‡§Ø‡§æ ‡§π‡•Ä ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§ï‡§®‡•ç‡§´‡§∞‡•ç‡§Æ ‡§ï‡§∞‡•Ç‡§® ‡§∞‡•á‡§ù‡•ç‡§Ø‡•Å‡§Æ‡•á ‡§§‡§Ø‡§æ‡§∞ ‡§ï‡§∞‡§£‡•ç‡§Ø‡§æ‡§ö‡•Ä ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§∏‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§æ._`;
                
            const urlEncodedMessage = encodeURIComponent(whatsappMessage);

            // 4. Update final screen
            document.getElementById('generated-code').textContent = data.code;
            document.getElementById('selected-template-display').textContent = `#${selectedTemplateOrder} (${data.templateName})`;
            
            // 5. Set WhatsApp link (URL Encoded message)
            document.getElementById('whatsapp-link').href = `https://wa.me/${businessWhatsappNumber}?text=${urlEncodedMessage}`;

            // 6. Set Copy button action to copy the full message
            document.getElementById('copy-code-btn').onclick = function() {
                const cleanTextForCopy = whatsappMessage.replace(/\*/g, '').replace(/_/g, '');
                
                const tempTextArea = document.createElement('textarea');
                tempTextArea.value = cleanTextForCopy;
                document.body.appendChild(tempTextArea);
                tempTextArea.select();
                try {
                    document.execCommand('copy');
                    alert('‡§∏‡§Ç‡§™‡•Ç‡§∞‡•ç‡§£ ‡§ë‡§∞‡•ç‡§°‡§∞‡§ö‡•Ä ‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä ‡§ï‡•â‡§™‡•Ä ‡§ù‡§æ‡§≤‡•Ä ‡§Ü‡§π‡•á! ‡§Ü‡§§‡§æ ‡§§‡•Å‡§Æ‡•ç‡§π‡•Ä ‡§§‡•Ä WhatsApp ‡§µ‡§∞ ‡§™‡•á‡§∏‡•ç‡§ü ‡§ï‡§∞‡•Ç ‡§∂‡§ï‡§§‡§æ.');
                } catch (err) {
                    console.error('Copy failed:', err);
                    alert('‡§ï‡•ã‡§° ‡§ï‡•â‡§™‡•Ä ‡§ï‡§∞‡§£‡•ç‡§Ø‡§æ‡§§ ‡§Ö‡§Ø‡§∂‡§∏‡•ç‡§µ‡•Ä. ‡§ï‡•É‡§™‡§Ø‡§æ WhatsApp ‡§¨‡§ü‡§£ ‡§µ‡§æ‡§™‡§∞‡§æ.');
                }
                document.body.removeChild(tempTextArea);
            };

            // 7. Show final step
            showStep(3);
        });

        // Initialize to Step 1
        window.onload = function() {
            showStep(1);
        };
    </script>
</body>
</html>
